var e=Object.getOwnPropertyNames;import{y as t,Q as a,al as n,h as o,z as l,A as r,I as s,r as i,X as c,ax as d,a4 as u,M as m,O as h,j as p,P as g,a6 as f,D as v,B as C,c as y,H as k,K as S,V as b,n as w,S as _,ay as T,az as A,aA as M,au as O}from"./vue-vendor-DQZkn0cN.js";import{E as P,c as L,s as I,a as R,u as x,b as D,i as E,d as F}from"./element-vendor-B-6OsB-C.js";import{a as N}from"./utils-ztdpVPaQ.js";var z,U,$=(z={"assets/index-CUj4wEvc.js"(e,z){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const U="hot_themes_cache",$="08:35",j=new class{constructor(){this.cache=null,this.lastUpdateTime=null,this.isLoading=!1,this.loadPromise=null,this.updateInProgress=!1}getCachedThemes(){try{const e=localStorage.getItem(U);if(e){const t=JSON.parse(e);if("1.2"===t.version&&this.isCacheValid(t.lastUpdate))return this.cache=t.themes,this.lastUpdateTime=t.lastUpdate,this.cache}}catch(e){}return null}isCacheValid(e){if(!e)return!1;const t=new Date,a=new Date(e),n=t.getTime()-a.getTime();return n<432e5&&n<6048e5}setCachedThemes(e){try{const t={themes:e,lastUpdate:(new Date).toISOString(),version:"1.2"};localStorage.setItem(U,JSON.stringify(t)),this.cache=e,this.lastUpdateTime=t.lastUpdate}catch(t){}}shouldUpdate(){if(this.updateInProgress)return!1;if(!this.getCachedThemes())return!0;if(!this.isCacheValid(this.lastUpdateTime))return!0;const e=new Date,t=new Date(this.lastUpdateTime);if(e.getTime()-t.getTime()>72e5&&e.toTimeString().slice(0,5)>=$){if(t.toDateString()!==e.toDateString())return!0;if(t.toTimeString().slice(0,5)<$)return!0}return!!this.isPageRefresh()}isToday(e){if(!e)return!1;const t=new Date(e),a=new Date;return t.toDateString()===a.toDateString()}isPageRefresh(){try{const e=sessionStorage.getItem("page_load_time"),t=Date.now();if(!e)return sessionStorage.setItem("page_load_time",t.toString()),!1;const a=parseInt(e);return t-a<3e5||(sessionStorage.setItem("page_load_time",t.toString()),!1)}catch(e){return!1}}getCacheInfo(){const e=this.getCachedThemes();return{hasCache:!!e,lastUpdate:this.lastUpdateTime,count:e?e.length:0,shouldUpdate:this.shouldUpdate()}}clearCache(){try{localStorage.removeItem(U),this.cache=null,this.lastUpdateTime=null}catch(e){}}};async function H(e){if(j.isLoading&&j.loadPromise)return j.loadPromise;const t=j.getCachedThemes();return t&&!j.shouldUpdate()?{themes:t,fromCache:!0,lastUpdate:j.lastUpdateTime}:(j.isLoading=!0,j.updateInProgress=!0,j.loadPromise=(async()=>{try{const t=await e(),a=(null==t?void 0:t.themes)||[];return j.setCachedThemes(a),{themes:a,fromCache:!1,lastUpdate:j.lastUpdateTime}}catch(t){const e=j.getCachedThemes();if(e)return{themes:e,fromCache:!0,lastUpdate:j.lastUpdateTime,isStale:!0};throw t}finally{j.isLoading=!1,j.updateInProgress=!1,j.loadPromise=null}})(),j.loadPromise)}const B=N.create({baseURL:"/api",timeout:15e3,headers:{"Content-Type":"application/json;charset=UTF-8","X-Requested-With":"XMLHttpRequest"}});function V(e,t,a={},n={}){const o={method:e,url:t,...n};return"get"===e.toLowerCase()?o.params=a:o.data=a,B(o)}B.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e.metadata={startTime:new Date},e},e=>Promise.reject(e)),B.interceptors.response.use(e=>{var t;const{data:a,config:n}=e;return null==(t=n.metadata)||t.startTime,a.code&&200!==a.code?(P.error(a.message||"请求失败"),Promise.reject(new Error(a.message||"请求失败"))):a},e=>{if(e.response){const{status:t,data:a}=e.response;switch(t){case 401:P.error("未授权，请重新登录"),localStorage.removeItem("token"),window.location.href="/login";break;case 403:P.error("禁止访问");break;case 404:P.error("请求的资源不存在");break;case 500:P.error("服务器内部错误");break;default:P.error((null==a?void 0:a.message)||`请求失败 (${t})`)}}else e.request?P.error("网络连接失败，请检查网络设置"):P.error("请求配置错误");return Promise.reject(e)});const J=(e,t={},a={})=>V("post",e,t,a);function K(e){return J("/stock/filter/zhibiao",{zhibiao:e})}const G=()=>((e,t={},a={})=>V("get",e,t,a))("/theme/list"),Y=new class{constructor(){this.observers=new Map,this.checkInterval=null,this.isMonitoring=!1}startMonitoring(e=3e4){this.isMonitoring||(this.isMonitoring=!0,this.checkInterval=setInterval(()=>{this.checkMemoryUsage()},e))}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.isMonitoring=!1}checkMemoryUsage(){if(!performance.memory)return;const e=performance.memory,t=Math.round(e.usedJSHeapSize/1024/1024),a=Math.round(e.totalJSHeapSize/1024/1024),n=Math.round(e.jsHeapSizeLimit/1024/1024),o=Math.round(t/n*100);o>80?this.triggerMemoryCleanup("critical"):o>60&&this.triggerMemoryCleanup("warning"),this.notifyObservers({usedMB:t,totalMB:a,limitMB:n,usagePercent:o,status:o>80?"critical":o>60?"warning":"normal"})}triggerMemoryCleanup(e){this.cleanupLocalStorage(),window.gc&&"function"==typeof window.gc&&window.gc(),this.notifyObservers({type:"cleanup",level:e})}cleanupLocalStorage(){try{const e=Object.keys(localStorage),t=Date.now();let a=0;e.forEach(e=>{try{const n=localStorage.getItem(e);if(n){const o=JSON.parse(n);o.timestamp&&t-new Date(o.timestamp).getTime()>6048e5&&(localStorage.removeItem(e),a++)}}catch(n){}})}catch(e){}}addObserver(e,t){this.observers.set(e,t)}removeObserver(e){this.observers.delete(e)}notifyObservers(e){this.observers.forEach((t,a)=>{try{t(e)}catch(n){}})}getMemoryInfo(){if(!performance.memory)return{error:"不支持内存监控"};const e=performance.memory;return{usedMB:Math.round(e.usedJSHeapSize/1024/1024),totalMB:Math.round(e.totalJSHeapSize/1024/1024),limitMB:Math.round(e.jsHeapSizeLimit/1024/1024),usagePercent:Math.round(e.usedJSHeapSize/e.jsHeapSizeLimit*100)}}};window.addEventListener("beforeunload",()=>{Y.stopMonitoring()});const q=(e,t)=>{const a=e.__vccOpts||e;for(const[n,o]of t)a[n]=o;return a},W={id:"app"},X=q({name:"App",setup(){o(async()=>{await async function(e){try{const t=j.getCacheInfo();if(t.shouldUpdate){const t=await H(e);return j.isPageRefresh(),t}return{themes:j.getCachedThemes()||[],fromCache:!0,lastUpdate:t.lastUpdate}}catch(t){throw t}}(G).catch(e=>{}),Y.addObserver("app",e=>{e.type})})}},[["render",function(e,o,r,s,i,c){const d=n("router-view");return l(),t("div",W,[a(d)])}]]),Q={class:"login-container"},Z={class:"login-box"},ee=q({name:"Login",setup(){const e=d(),t=i(),a=i(!1),n=c({username:"",password:"",rememberMe:!1});return{loginForm:n,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},loginFormRef:t,loading:a,handleLogin:async()=>{var o;if(t.value)try{if(!(await t.value.validate()))return;a.value=!0;const o=await N.post("/api/login",n);o.data.token?(localStorage.setItem("token",o.data.token),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("username",n.username),P.success("登录成功！"),e.push("/stock-filter")):P.error("登录失败，请检查用户名和密码")}catch(l){401===(null==(o=l.response)?void 0:o.status)?P.error("用户名或密码错误"):P.error("登录失败，请重试")}finally{a.value=!1}}}}},[["render",function(e,o,i,c,d,p){const g=n("el-input"),f=n("el-form-item"),v=n("el-checkbox"),C=n("el-button"),y=n("el-form");return l(),t("div",Q,[r("div",Z,[o[4]||(o[4]=r("div",{class:"login-header"},[r("h2",null,"选股助手"),r("p",null,"股票筛选分析系统")],-1)),a(y,{model:c.loginForm,rules:c.rules,ref:"loginFormRef",class:"login-form",size:"large"},{default:s(()=>[a(f,{prop:"username"},{default:s(()=>[a(g,{modelValue:c.loginForm.username,"onUpdate:modelValue":o[0]||(o[0]=e=>c.loginForm.username=e),placeholder:"请输入用户名","prefix-icon":"User",clearable:""},null,8,["modelValue"])]),_:1}),a(f,{prop:"password"},{default:s(()=>[a(g,{modelValue:c.loginForm.password,"onUpdate:modelValue":o[1]||(o[1]=e=>c.loginForm.password=e),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":"",onKeyup:u(c.handleLogin,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(f,null,{default:s(()=>[a(v,{modelValue:c.loginForm.rememberMe,"onUpdate:modelValue":o[2]||(o[2]=e=>c.loginForm.rememberMe=e)},{default:s(()=>o[3]||(o[3]=[m(" 记住我 ")])),_:1,__:[3]},8,["modelValue"])]),_:1}),a(f,null,{default:s(()=>[a(C,{type:"primary",class:"login-btn",loading:c.loading,onClick:c.handleLogin,size:"large"},{default:s(()=>[m(h(c.loading?"登录中...":"登录"),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model","rules"]),o[5]||(o[5]=r("div",{class:"login-footer"},[r("p",null,"演示账号：admin / 123456")],-1))])])}],["__scopeId","data-v-aa4bc762"]]),te={name:"DataRangeSelector",components:{Close:L},props:{title:{type:String,default:"选择范围"},ranges:{type:Array,default:()=>[]},selectedRange:{type:String,default:""},visible:{type:Boolean,default:!1}},emits:["range-select","close"],setup(e,{emit:t}){const a=i(e.selectedRange);return p(()=>e.selectedRange,e=>{a.value=e}),p(()=>e.visible,t=>{t&&(a.value=e.selectedRange)}),{currentSelected:a,handleRangeSelect:e=>{a.value=e,t("range-select",e),t("close")},handleClose:()=>{t("close")},handleShow:()=>{a.value=e.selectedRange},handleHide:()=>{}}}},ae={class:"data-range-selector"},ne={class:"range-content"},oe={class:"range-header"},le={class:"range-title"},re={class:"range-list"},se=["onClick"],ie={name:"FilterItem",components:{DataRangeSelector:q(te,[["render",function(e,o,i,c,d,u){const m=n("Close"),p=n("el-icon"),y=n("el-button"),k=n("el-popover");return l(),t("div",ae,[a(k,{visible:i.visible,placement:"bottom",width:300,trigger:"manual","popper-class":"range-selector-popover",onShow:c.handleShow,onHide:c.handleHide},{reference:s(()=>[C(e.$slots,"default",{},void 0,!0)]),default:s(()=>[r("div",ne,[r("div",oe,[r("span",le,h(i.title),1),a(y,{link:"",class:"close-btn",onClick:c.handleClose},{default:s(()=>[a(p,null,{default:s(()=>[a(m)]),_:1})]),_:1},8,["onClick"])]),r("div",re,[(l(!0),t(g,null,f(i.ranges,(e,a)=>(l(),t("div",{key:a,class:v(["range-item",{selected:c.currentSelected===e}]),onClick:t=>c.handleRangeSelect(e)},h(e),11,se))),128))])])]),_:3},8,["visible","onShow","onHide"])])}],["__scopeId","data-v-16e5a6ad"]]),Close:L},props:{condition:{type:Object,required:!0},conditionKey:{type:String,required:!0},selectedValue:{type:String,default:""},disabled:{type:Boolean,default:!1},selectorId:{type:String,required:!0},isSelectorOpen:{type:Boolean,default:!1}},emits:["item-change","selector-open","selector-close"],setup(e,{emit:t}){const a=i(!1),n=y(()=>e.disabled||!e.condition.ranges||0===e.condition.ranges.length);return{isHovering:a,isDisabled:n,handleMouseEnter:()=>!n.value&&(a.value=!0),handleMouseLeave:()=>a.value=!1,handleClick:()=>{n.value||t(e.isSelectorOpen?"selector-close":"selector-open")},handleRangeSelect:a=>{t("item-change",{key:e.conditionKey,value:a,condition:e.condition})},handleSelectorClose:()=>t("selector-close"),handleCancel:()=>{a.value=!1,t("item-change",{key:e.conditionKey,value:"",condition:e.condition})}}}},ce={class:"filter-item"},de={class:"filter-name"},ue={key:0,class:"unit"},me={key:1,class:"selected-value"},he={key:1,class:"filter-tag disabled"},pe={class:"filter-name"},ge={key:0,class:"unit"},fe=q(ie,[["render",function(e,o,i,c,d,u){const m=n("Close"),p=n("el-icon"),g=n("DataRangeSelector");return l(),t("div",ce,[c.isDisabled?(l(),t("div",he,[r("span",pe,h(i.condition.name),1),i.condition.unit?(l(),t("span",ge,"("+h(i.condition.unit)+")",1)):S("",!0),o[3]||(o[3]=r("span",{class:"disabled-text"},": 待开发",-1))])):(l(),t("div",{key:0,class:v(["filter-tag",{"has-value":i.selectedValue,hover:c.isHovering}]),onMouseenter:o[0]||(o[0]=(...e)=>c.handleMouseEnter&&c.handleMouseEnter(...e)),onMouseleave:o[1]||(o[1]=(...e)=>c.handleMouseLeave&&c.handleMouseLeave(...e)),onClick:o[2]||(o[2]=(...e)=>c.handleClick&&c.handleClick(...e))},[r("span",de,h(i.condition.name),1),i.condition.unit?(l(),t("span",ue,"("+h(i.condition.unit)+")",1)):S("",!0),i.selectedValue?(l(),t("span",me,": "+h(i.selectedValue),1)):S("",!0),i.selectedValue?(l(),k(p,{key:2,class:"cancel-btn",onClick:b(c.handleCancel,["stop"])},{default:s(()=>[a(m)]),_:1},8,["onClick"])):S("",!0)],34)),c.isDisabled?S("",!0):(l(),k(g,{key:2,title:`选择${i.condition.name}范围`,ranges:i.condition.ranges,"selected-range":i.selectedValue,visible:i.isSelectorOpen,onRangeSelect:c.handleRangeSelect,onClose:c.handleSelectorClose},{default:s(()=>o[4]||(o[4]=[r("span",null,null,-1)])),_:1,__:[4]},8,["title","ranges","selected-range","visible","onRangeSelect","onClose"]))])}],["__scopeId","data-v-6c5797e0"]]),ve=["打板","抄底","低吸","追涨","龙头"],Ce={fundamental:["营业收入","市盈率","销售毛利率","ROE","净利润","市净率","资产负债率"],technical:["MACD","KDJ","BOLL","单k组合","均线"],capital:["大单净量","大单净额","陆股通净流入"]},ye={"营业收入":["5以下","5~10","10~20","20~50","50以上"],"市盈率":["10以下","10~20","20~30","30~40"],"销售毛利率":["5以下","5~20","20~35","35~40","40以上"],ROE:["5以下","5~10","10~20","20以上"],"净利润":["亏损","0~1","1~3","3~5","5以上"],"市净率":["1以下","1~1.5","1.5~2","2~3","3以上"],"资产负债率":["10以下","10~15","15~30","30以上"],MACD:["金叉","底背离","拐头向上","0轴金叉"],KDJ:["金叉","底背离","拐头向上"],BOLL:["突破上轨","突破下轨","突破中轨","开口向上"],"单k组合":["大阳线","小阳星","向上跳空缺口","向下跳空","长下影线","长上影线"],"均线":["多头排列","均线粘合","股价站上5日线","股价站上60日线"],"大单净量":["小于0","0~1","1~3","大于3"],"大单净额":["小于0","0~1000","1000~5000","大于5000"],"陆股通净流入":["小于0","0~1000","1000~5000","5000~10000","大于10000"]};"undefined"!=typeof window&&(window.FactorConfig={INDICATOR_OPTIONS:ve,FACTOR_CATEGORIES:Ce,FACTOR_RANGES:ye}),void 0!==z&&z.exports&&(z.exports={INDICATOR_OPTIONS:ve,FACTOR_CATEGORIES:Ce,FACTOR_RANGES:ye});const ke={indicator:{name:"特色指标",status:"active"},hotConcept:{name:"热门概念",status:"active"},fundamental:{name:"基本面",status:"active"},technical:{name:"技术面",status:"active"},capital:{name:"资金面",status:"active"}},Se={indicator:{special:{name:"特色指标",ranges:ve}},fundamental:{revenue:{name:"营业收入",type:"range",ranges:ye["营业收入"]},pe:{name:"市盈率",type:"range",ranges:ye["市盈率"]},grossMargin:{name:"销售毛利率",type:"range",ranges:ye["销售毛利率"]},roe:{name:"ROE",type:"range",ranges:ye.ROE},netProfit:{name:"净利润",type:"range",ranges:ye["净利润"]},pb:{name:"市净率",type:"range",ranges:ye["市净率"]},debtRatio:{name:"资产负债率",type:"range",ranges:ye["资产负债率"]}},technical:{macd:{name:"MACD",ranges:ye.MACD},kdj:{name:"KDJ",ranges:ye.KDJ},boll:{name:"BOLL",ranges:ye.BOLL},kPattern:{name:"单k组合",ranges:ye["单k组合"]},ma:{name:"均线",ranges:ye["均线"]}},capital:{bigOrderNet:{name:"大单净量",ranges:ye["大单净量"]},bigOrderAmount:{name:"大单净额",unit:"万元",ranges:ye["大单净额"]},hkConnect:{name:"陆股通净流入",unit:"万元",ranges:ye["陆股通净流入"]}}},be={class:"filter-panel"},we={class:"filter-content"},_e={class:"category-label"},Te={class:"category-conditions"},Ae={key:0,class:"conditions-container"},Me={class:"hot-theme-list",title:"热门概念"},Oe={class:"theme-name"},Pe={key:1,class:"conditions-container"},Le={class:"indicator-list",title:"特色指标"},Ie={key:2,class:"conditions-container"},Re={key:3,class:"pending-status"},xe={key:4,class:"loading-status"},De={class:"filter-actions"},Ee={class:"selected-summary"},Fe={class:"summary-text"},Ne={class:"action-buttons"},ze={class:"theme-content"},Ue={class:"theme-header"},$e={class:"theme-search"},je={class:"theme-list"},He=["onClick"],Be={class:"theme-name"},Ve=q({name:"FilterPanel",components:{FilterItem:fe},emits:["filter-change"],setup(e,{emit:t}){const a=i({}),n=c({}),l=c({}),r=i([]),s=i([]),d=i(!1),u=i(null),m=i(!1),h=i(""),p=i(null),g=y(()=>{const e=Array.isArray(p.value)?p.value[0]:p.value;return e?e.$el||e:null}),f=y(()=>{let e=0;return Object.values(l).forEach(t=>{t&&(e+=Object.values(t).filter(e=>e).length)}),e}),v=y(()=>r.value.slice(0,10)),C=y(()=>{if(!h.value.trim())return r.value;const e=h.value.toLowerCase();return r.value.filter(t=>t.name.toLowerCase().includes(e))}),k=y(()=>{var e,t;return(null==(t=null==(e=null==Se?void 0:Se.indicator)?void 0:e.special)?void 0:t.ranges)||["打板","抄底","低吸","追涨","龙头"]});return o(async()=>{d.value=!0,a.value={...ke},Object.keys(a.value).filter(e=>"active"===a.value[e].status).forEach(e=>{n[e]=Se[e]||{}}),a.value.hotConcept={name:"热门概念",status:"active"},(async()=>{try{a.value.hotConcept?a.value.hotConcept.status="active":a.value.hotConcept={name:"热门概念",status:"active"};const e=await H(G),t=e.themes||[];e.fromCache;let n=[];Array.isArray(t)&&(n=t.map(e=>"object"==typeof e&&e.name?{name:e.name,stockCount:e.stock_count||0,maxHotNum:e.max_hot_num||0,totalHotNum:e.total_hot_num||0}:{name:e,stockCount:0,maxHotNum:0,totalHotNum:0})),n.sort((e,t)=>e.stockCount!==t.stockCount?t.stockCount-e.stockCount:t.maxHotNum-e.maxHotNum),r.value=n}catch(e){r.value=[]}})().catch(e=>{}),d.value=!1}),{filterCategories:a,filterConditions:n,selectedFilters:l,loading:d,selectedCount:f,currentOpenSelector:u,handleItemChange:(e,a)=>{l[e]||(l[e]={}),a.value?l[e][a.key]=a.value:(delete l[e][a.key],0===Object.keys(l[e]).length&&delete l[e]),t("filter-change",{category:e,condition:a.key,value:a.value,allFilters:{...l}})},handleSelectorOpen:e=>u.value=e,handleSelectorClose:()=>u.value=null,handleReset:()=>{Object.keys(l).forEach(e=>delete l[e]),s.value=[],t("filter-change",{category:null,condition:null,value:null,allFilters:{}}),P.success("筛选条件已重置")},indicatorOptions:k,handleSelectIndicator:e=>{l.indicator||(l.indicator={}),l.indicator.special===e?(delete l.indicator.special,0===Object.keys(l.indicator).length&&delete l.indicator,t("filter-change",{category:"indicator",condition:"special",value:"",allFilters:{...l}})):(l.indicator.special=e,t("filter-change",{category:"indicator",condition:"special",value:e,allFilters:{...l}}))},clearIndicator:()=>{l.indicator&&(delete l.indicator.special,0===Object.keys(l.indicator).length&&delete l.indicator,t("filter-change",{category:"indicator",condition:"special",value:"",allFilters:{...l}}))},allThemes:r,topThemes:v,selectedThemes:s,handleSelectTheme:e=>{s.value.includes(e)?s.value=s.value.filter(t=>t!==e):s.value.push(e),l.hotConcept||(l.hotConcept={}),l.hotConcept.themes=[...s.value],t("filter-change",{category:"hotConcept",condition:"theme",value:s.value,allFilters:{...l}})},clearThemeSelection:()=>{s.value=[],l.hotConcept&&(delete l.hotConcept.themes,0===Object.keys(l.hotConcept).length&&delete l.hotConcept),t("filter-change",{category:"hotConcept",condition:"themeResult",value:"",allFilters:{...l},themeRows:[]})},moreThemesPopoverVisible:m,searchKeyword:h,filteredThemes:C,moreButtonRef:p,moreButtonEl:g,showMoreThemes:async()=>{await w(),m.value=!0,h.value=""},handleSelectThemeFromPopover:e=>{s.value.includes(e)?s.value=s.value.filter(t=>t!==e):s.value.push(e),l.hotConcept||(l.hotConcept={}),l.hotConcept.themes=[...s.value],m.value=!1,t("filter-change",{category:"hotConcept",condition:"theme",value:s.value,allFilters:{...l}})},handleSearch:()=>{},handlePopoverShow:()=>{h.value=""},handlePopoverHide:()=>{},handlePopoverClose:()=>{m.value=!1}}}},[["render",function(e,o,i,c,d,u){const p=n("TrendCharts"),C=n("el-icon"),y=n("Close"),w=n("el-tag"),_=n("FilterItem"),T=n("el-skeleton"),A=n("el-button"),M=n("el-card"),O=n("Search"),P=n("el-input"),L=n("el-popover");return l(),t("div",be,[a(M,{class:"filter-card",shadow:"never"},{header:s(()=>o[1]||(o[1]=[r("div",{class:"card-header"},[r("span",{class:"title"},"股票筛选条件")],-1)])),default:s(()=>[r("div",we,[(l(!0),t(g,null,f(c.filterCategories,(e,n)=>(l(),t("div",{key:n,class:v(["filter-category-row",{"indicator-row":"indicator"===n}])},[r("div",_e,[r("span",{class:v(["category-name",{disabled:"pending"===e.status}])},["indicator"===n?(l(),t(g,{key:0},[a(C,{class:"indicator-icon"},{default:s(()=>[a(p)]),_:1}),o[2]||(o[2]=r("span",{class:"indicator-badge"},"特色指标",-1))],64)):(l(),t(g,{key:1},[m(h(e.name),1)],64))],2)]),r("div",Te,["hotConcept"===n&&"active"===e.status?(l(),t("div",Ae,[r("div",Me,[(l(!0),t(g,null,f(c.topThemes,e=>(l(),k(w,{key:e.name,class:v(["hot-theme-tag",{selected:c.selectedThemes.includes(e.name)}]),effect:"plain",type:c.selectedThemes.includes(e.name)?"primary":"info",onClick:t=>c.handleSelectTheme(e.name)},{default:s(()=>[r("span",Oe,h(e.name),1),c.selectedThemes.includes(e.name)?(l(),k(C,{key:0,class:"cancel-btn",onClick:b(t=>c.handleSelectTheme(e.name),["stop"])},{default:s(()=>[a(y)]),_:2},1032,["onClick"])):S("",!0)]),_:2},1032,["class","type","onClick"]))),128)),c.allThemes.length>10?(l(),k(w,{key:0,ref_for:!0,ref:"moreButtonRef",class:"hot-theme-tag more-btn",effect:"plain",type:"info",onClick:c.showMoreThemes},{default:s(()=>[m(" 更多("+h(c.allThemes.length-10)+") ",1)]),_:1},8,["onClick"])):S("",!0)])])):"indicator"===n&&"active"===e.status?(l(),t("div",Pe,[r("div",Le,[(l(!0),t(g,null,f(c.indicatorOptions,e=>{var t,n;return l(),k(w,{key:e,class:v(["indicator-btn",{selected:(null==(t=c.selectedFilters.indicator)?void 0:t.special)===e}]),effect:"plain",type:(null==(n=c.selectedFilters.indicator)?void 0:n.special)===e?"primary":"info",onClick:t=>c.handleSelectIndicator(e)},{default:s(()=>{var t;return[r("span",null,h(e),1),(null==(t=c.selectedFilters.indicator)?void 0:t.special)===e?(l(),k(C,{key:0,class:"cancel-btn",onClick:b(c.clearIndicator,["stop"])},{default:s(()=>[a(y)]),_:1},8,["onClick"])):S("",!0)]}),_:2},1032,["class","type","onClick"])}),128))])])):"active"===e.status&&c.filterConditions[n]?(l(),t("div",Ie,[(l(!0),t(g,null,f(c.filterConditions[n],(t,a)=>{var o;return l(),k(_,{key:a,condition:t,"condition-key":a,"selected-value":(null==(o=c.selectedFilters[n])?void 0:o[a])||"",disabled:"pending"===e.status,"selector-id":`${n}-${a}`,"is-selector-open":c.currentOpenSelector===`${n}-${a}`,onItemChange:e=>c.handleItemChange(n,e),onSelectorOpen:e=>c.handleSelectorOpen(`${n}-${a}`),onSelectorClose:c.handleSelectorClose},null,8,["condition","condition-key","selected-value","disabled","selector-id","is-selector-open","onItemChange","onSelectorOpen","onSelectorClose"])}),128))])):"pending"===e.status?(l(),t("div",Re,o[3]||(o[3]=[r("span",{class:"pending-text"},"待开发",-1)]))):(l(),t("div",xe,[a(T,{rows:2,animated:""})]))])],2))),128))]),r("div",De,[r("div",Ee,[r("span",Fe," 已选择 "+h(c.selectedCount)+" 个筛选条件 ",1)]),r("div",Ne,[a(A,{onClick:c.handleReset},{default:s(()=>o[4]||(o[4]=[m("清除条件")])),_:1,__:[4]},8,["onClick"])])])]),_:1}),a(L,{visible:c.moreThemesPopoverVisible,placement:"bottom-start",width:400,trigger:"manual","popper-class":"theme-selector-popover",offset:8,"virtual-ref":c.moreButtonEl,"virtual-triggering":"",onShow:c.handlePopoverShow,onHide:c.handlePopoverHide},{default:s(()=>[r("div",ze,[r("div",Ue,[o[5]||(o[5]=r("span",{class:"theme-title"},"所有热门题材",-1)),a(A,{link:"",class:"close-btn",onClick:c.handlePopoverClose},{default:s(()=>[a(C,null,{default:s(()=>[a(y)]),_:1})]),_:1},8,["onClick"])]),r("div",$e,[a(P,{modelValue:c.searchKeyword,"onUpdate:modelValue":o[0]||(o[0]=e=>c.searchKeyword=e),placeholder:"搜索题材名称",clearable:"",size:"small",class:"search-input",onInput:c.handleSearch},{prefix:s(()=>[a(C,null,{default:s(()=>[a(O)]),_:1})]),_:1},8,["modelValue","onInput"])]),r("div",je,[(l(!0),t(g,null,f(c.filteredThemes,e=>(l(),t("div",{key:e.name,class:v(["theme-item",{selected:c.selectedThemes.includes(e.name)}]),onClick:t=>c.handleSelectThemeFromPopover(e.name)},[r("span",Be,h(e.name),1)],10,He))),128))])])]),_:1},8,["visible","virtual-ref","onShow","onHide"])])}],["__scopeId","data-v-a3b89a8d"]]),Je={class:"header-container"},Ke={class:"header-right app-right"},Ge={class:"user-info"},Ye=q({name:"AppHeader",components:{User:x,ArrowDown:R,SwitchButton:I},emits:["logout"],setup(e,{emit:t}){const a=d();return{currentUser:y(()=>localStorage.getItem("username")||"用户"),handleCommand:async e=>{if("logout"===e)try{await D.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("username"),P.success("已退出登录"),a.push("/login"),t("logout")}catch(n){}}}}},[["render",function(e,t,o,i,c,d){const u=n("User"),p=n("el-icon"),g=n("arrow-down"),f=n("SwitchButton"),v=n("el-dropdown-item"),C=n("el-dropdown-menu"),y=n("el-dropdown"),S=n("el-header");return l(),k(S,{class:"app-header"},{default:s(()=>[r("div",Je,[t[1]||(t[1]=r("div",{class:"header-left app-left"},[r("h2",{class:"app-title"},"选股助手")],-1)),r("div",Ke,[a(y,{onCommand:i.handleCommand},{dropdown:s(()=>[a(C,null,{default:s(()=>[a(v,{command:"logout"},{default:s(()=>[a(p,null,{default:s(()=>[a(f)]),_:1}),t[0]||(t[0]=m(" 退出登录 "))]),_:1,__:[0]})]),_:1})]),default:s(()=>[r("span",Ge,[a(p,null,{default:s(()=>[a(u)]),_:1}),m(" "+h(i.currentUser)+" ",1),a(p,{class:"el-icon--right"},{default:s(()=>[a(g)]),_:1})])]),_:1},8,["onCommand"])])])]),_:1})}],["__scopeId","data-v-23f4fab1"]]),qe=e=>e>0?"price-up":e<0?"price-down":"price-neutral",We=(e,t,a)=>{if(null==a||""===a)return"-";const n=Number(a);return isNaN(n)?"-":`${n.toFixed(2)}%`},Xe=(e,t,a)=>{if(null==a||""===a)return"-";const n=Number(a);return isNaN(n)?"-":n.toFixed(2)},Qe=(e,t,a)=>{if(null==a||""===a)return"-";const n=Number(a);return isNaN(n)?"-":n.toFixed(2)},Ze=(e,t,a)=>{if(null==a||""===a)return"-";const n=Number(a);return isNaN(n)?"-":`${(n/1e8).toFixed(2)}亿`},et=new Map,tt=e=>{if(!e)return"#";if(et.has(e))return et.get(e);const t=`${window.__ANALYSIS_HOST||"http://192.168.1.188:8077"}/analysis?stock_code=${encodeURIComponent(e)}`;return et.set(e,t),t},at=new Map,nt=e=>{if(!e)return"#";if(at.has(e))return at.get(e);const t=`http://www.treeid/code_${e}`;return at.set(e,t),t};(()=>{try{const e=navigator.userAgent||"",t=/TdxBrowser|TdxW|tdx|TongDaXin/i.test(e),a=!(!window.external||!window.external.GetCookie&&!window.external.GetSecurityInfo);window.tdxBrowser=Boolean(t||a)}catch(e){window.tdxBrowser=!1}})();const ot=(e,t)=>{try{const a=(()=>{try{return new URL(window.location.href).searchParams}catch{return new URLSearchParams("")}})(),n=/^(1|true)$/i.test(a.get("tdx")||""),o=!!window.tdxBrowser||n;if(!(()=>{try{const e=navigator.userAgent||"";return/Android|webOS|iPhone|iPod|iPad|BlackBerry|IEMobile|Opera Mini/i.test(e)}catch(e){return!1}})()&&o)return e&&"function"==typeof e.preventDefault&&e.preventDefault(),window.location.href=nt(t),"tdx"}catch(a){}return!1},lt=["code","股票简称","净利润","营业收入","销售毛利率","资产负债率","ROE","市净率","市盈率","大单净量","大单净额"],rt=new class{constructor(){this.metrics=new Map,this.startTime=performance.now(),this.isGuangdaBrowser=this.checkGuangdaBrowser(),this.compatibilityIssues=this.checkCompatibility()}recordMetric(e,t){this.metrics.set(e,t)}startTimer(e){this.metrics.set(`${e}_start`,performance.now())}endTimer(e){const t=this.metrics.get(`${e}_start`);if(t){const a=performance.now()-t;return this.metrics.set(e,a),this.metrics.delete(`${e}_start`),a}return 0}checkGuangdaBrowser(){const e=navigator.userAgent.toLowerCase();return e.includes("guangda")||e.includes("光大")||e.includes("gd")||e.includes("tdx")||e.includes("tongdaxin")||e.includes("通达信")}checkCompatibility(){const e=[];window.requestAnimationFrame||e.push("requestAnimationFrame not supported"),window.IntersectionObserver||e.push("IntersectionObserver not supported");const t=document.createElement("div");t.style.cssText="backdrop-filter: blur(10px);",t.style.backdropFilter||e.push("backdrop-filter not supported");const a=document.createElement("canvas");return a.getContext("webgl")||a.getContext("experimental-webgl")||e.push("WebGL not supported"),e}getReport(){const e={totalTime:performance.now()-this.startTime,metrics:Object.fromEntries(this.metrics),isGuangdaBrowser:this.isGuangdaBrowser,compatibilityIssues:this.compatibilityIssues,memoryUsage:this.getMemoryUsage(),timestamp:(new Date).toISOString()};return this.cleanupOldMetrics(),e}cleanupOldMetrics(){if(this.metrics.size>50){const e=Array.from(this.metrics.entries());e.slice(0,e.length-30).forEach(([e])=>this.metrics.delete(e))}}getMemoryUsage(){return performance.memory?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}:null}monitorTableRender(e,t){this.startTimer(`table_${e}_render`);const a=t();return this.endTimer(`table_${e}_render`),a}monitorApiRequest(e,t){return this.startTimer(`api_${e}`),t().finally(()=>{this.endTimer(`api_${e}`)})}getOptimizationSuggestions(){const e=[],t=this.getReport();return t.totalTime>3e3&&e.push("页面加载时间超过3秒，建议优化初始渲染性能"),t.memoryUsage&&t.memoryUsage.usedJSHeapSize>52428800&&e.push("内存使用超过50MB，建议检查内存泄漏"),this.compatibilityIssues.length>0&&e.push(`检测到兼容性问题: ${this.compatibilityIssues.join(", ")}`),this.isGuangdaBrowser&&e.push("检测到光大证券浏览器环境，已启用兼容性优化"),e}};window.addEventListener("load",()=>{setTimeout(()=>{rt.getReport(),rt.getOptimizationSuggestions().length,rt.isGuangdaBrowser},1e3)});let st=null;performance.memory&&(st=setInterval(()=>{const e=rt.getMemoryUsage();e&&e.usedJSHeapSize},18e4)),window.addEventListener("beforeunload",()=>{st&&clearInterval(st)});const it=new class{constructor(){this.cleanupTasks=new Set,this.optimizationEnabled=!0,this.memoryThreshold=41943040}addCleanupTask(e){this.cleanupTasks.add(e)}removeCleanupTask(e){this.cleanupTasks.delete(e)}executeCleanupTasks(){this.cleanupTasks.forEach(e=>{try{e()}catch(t){}})}checkAndOptimize(){return!(!window.performance||!window.performance.memory)&&(window.performance.memory.usedJSHeapSize>this.memoryThreshold&&(this.executeCleanupTasks(),window.gc&&"function"==typeof window.gc&&window.gc(),!0))}optimizeObject(e,t=[]){if(!e||"object"!=typeof e)return e;const a={};return t.forEach(t=>{e.hasOwnProperty(t)&&(a[t]=e[t])}),a}deduplicateArray(e){return Array.isArray(e)?[...new Set(e)]:e}cleanupCollection(e,t){if(!e||"function"!=typeof t)return;const a=[];for(const[n,o]of e.entries())t(o)&&a.push(n);a.forEach(t=>e.delete(t))}},ct=new class{constructor(e=1e3){this.cache=new Map,this.maxSize=e}get(e){return this.cache.get(e)}set(e,t){if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}clear(){this.cache.clear()}};function dt(){const e=i(1),t=i(20),a=i(0),n=i(null),o=i({}),l=i(new Set),r=i(new Map),s=12e4,c=setInterval(()=>{const e=Date.now(),t=r.value;for(const[n,o]of t.entries())e-o.timestamp>s&&t.delete(n);if(t.size>50){const e=Array.from(t.entries());e.sort((e,t)=>e[1].timestamp-t[1].timestamp),e.slice(0,t.size-50+20).forEach(([e])=>t.delete(e))}const a=Object.keys(o.value);if(a.length>50){const e=Math.floor(40);a.slice(0,a.length-e).forEach(e=>delete o.value[e])}},6e4);return _(()=>{c&&clearInterval(c),r.value.clear(),o.value={},l.value.clear(),it.executeCleanupTasks(),window.gc&&"function"==typeof window.gc&&window.gc()}),{currentPage:e,pageSize:t,tableRenderKey:a,tableRef:n,currentSort:{prop:"code",order:"ascending"},stockTooltips:o,loadingStocks:l,handleStockNameHover:async e=>{const t=`tooltip_${e}`,a=r.value.get(t);if(a&&Date.now()-a.timestamp<s)o.value={...o.value,[e]:a.data};else if(!o.value[e]&&!l.value.has(e)){l.value.add(e);try{const a=await(n=`stock_detail_${e}`,i=()=>function(e){return J("/stock/filter/detail",{code:e})}(e),rt.monitorApiRequest(n,i));let s=null;if((null==a?void 0:a.data)?s=a.data:a&&(s=a),s){const a={latest_theme:s.latest_theme||s.latestTheme||s.theme||"",recent_fluctuation_theme:s.recent_fluctuation_theme||s.recentFluctuationTheme||s.fluctuation_theme||"",...s};o.value={...o.value,[e]:a},r.value.set(t,{data:a,timestamp:Date.now()}),await w(),setTimeout(()=>{l.value.delete(e)},100)}else o.value={...o.value,[e]:{error:!0}},l.value.delete(e)}catch(c){o.value={...o.value,[e]:{error:!0}},l.value.delete(e)}var n,i}},getStockTooltipContent:e=>{const t=o.value[e];if(l.value.has(e))return'<div style="padding: 6px; font-size: 12px;">加载中...</div>';if(t&&t.error)return'<div style="padding: 6px; font-size: 12px;">获取信息失败</div>';if(!t)return'<div style="padding: 6px; font-size: 12px;">暂无详细信息</div>';const a=[];return t.latest_theme&&(a.push(t.latest_theme),a.push("")),t.recent_fluctuation_theme&&a.push(t.recent_fluctuation_theme),`\n      <div style="padding: 6px; font-size: 12px; max-width: 280px;">\n        ${a.join("<br>").replace(/\n/g,"<br>")}\n      </div>\n    `},onCodeClick:(e,t)=>{if("true"!==e.target.dataset.clicking)return e.target.dataset.clicking="true",setTimeout(()=>{e.target.dataset.clicking="false"},1e3),ot(e,t)},isSortableColumn:e=>!["股票简称","题材描述","主题","MACD","KDJ","BOLL","单k组合","均线"].includes(e),formatStockAnalysisUrl:tt,formatTreeIdUrl:nt,handleStockCodeClick:ot,formatMoney:Qe,formatYiYuan:Ze,formatPercent:We,formatNumber:Xe}}window.addEventListener("beforeunload",()=>{it.executeCleanupTasks(),ct.clear()});const ut={name:"StockTable",props:{stockList:{type:Array,default:()=>[]},isThemeMode:{type:Boolean,default:!1},themeColumns:{type:Array,default:()=>[]},dataColumns:{type:Array,default:()=>[]},showTimeFilter:{type:Boolean,default:!1},dateRange:{type:Array,default:()=>[]}},emits:["date-range-change","sort-change","view-detail","update:dateRange"],setup(e,{emit:t}){const a=dt(),n=y(()=>e.themeColumns.filter(e=>"name"!==e&&"交易所代码"!==e&&"ts_code"!==e&&"code"!==e)),o=y(()=>e.dataColumns.filter(e=>"name"!==e&&"交易所代码"!==e&&"ts_code"!==e&&"code"!==e)),l=y(()=>{const e=window.innerHeight;return Math.min(.6*e,500)}),r=y(()=>Math.min(.7*window.innerHeight,600)),s=y(()=>{const t=[...e.stockList];if(a.currentSort.prop){const{prop:e,order:n}=a.currentSort,o="descending"===n?-1:1;t.sort((t,a)=>{const n=t[e],l=a[e];return"number"==typeof n&&"number"==typeof l?(n-l)*o:String(n??"").localeCompare(String(l??""))*o})}else{const e="股票代码";t.sort((t,a)=>String(t[e]??"").localeCompare(String(a[e]??"")))}const n=(a.currentPage.value-1)*a.pageSize.value,o=n+a.pageSize.value;return t.slice(n,o)}),c=i(null),d=y({get:()=>e.dateRange,set:e=>t("update:dateRange",e)});return p(()=>e.stockList,e=>{const t=Math.max(1,Math.ceil(e.length/a.pageSize.value));a.currentPage.value>t&&(a.currentPage.value=1)}),_(()=>{c.value&&clearTimeout(c.value)}),{currentPage:a.currentPage,pageSize:a.pageSize,tableRenderKey:a.tableRenderKey,tableRef:a.tableRef,paginatedStockList:s,visibleThemeColumns:n,visibleDataColumns:o,headerCellStyle:{background:"#f8fafc",color:"#374151",fontWeight:"600",textAlign:"center",borderBottom:"2px solid #e5e7eb"},cellStyle:{textAlign:"center",padding:"8px 6px",fontSize:"13px"},tableHeight:l,tableMaxHeight:r,handlePageSizeChange:e=>{clearTimeout(c.value),c.value=setTimeout(()=>{a.pageSize.value=e,a.currentPage.value=1},100)},handleCurrentPageChange:e=>{clearTimeout(c.value),c.value=setTimeout(()=>{a.currentPage.value=e},100)},handleSortChange:({prop:e,order:n})=>{a.currentSort.prop=e,a.currentSort.order=n,a.currentPage.value=1,t("sort-change",{prop:e,order:n})},handleDateRangeChange:()=>{t("date-range-change",e.dateRange)},dateRangeProxy:d,resetTable:()=>{a.currentPage.value=1,a.currentSort.prop="code",a.currentSort.order="ascending",w(()=>{var e;(null==(e=a.tableRef.value)?void 0:e.clearSort)&&a.tableRef.value.clearSort(),a.tableRenderKey.value++})},stockTooltips:a.stockTooltips,handleStockNameHover:a.handleStockNameHover,getStockTooltipContent:a.getStockTooltipContent,onCodeClick:a.onCodeClick,isSortableColumn:a.isSortableColumn,formatStockAnalysisUrl:a.formatStockAnalysisUrl,formatTreeIdUrl:a.formatTreeIdUrl,handleStockCodeClick:a.handleStockCodeClick,formatMoney:a.formatMoney,formatYiYuan:a.formatYiYuan,formatPercent:a.formatPercent,formatNumber:a.formatNumber,getStockCode:e=>e["股票代码"]||e.code||e.code||"",getColumnLabel:e=>({"股票代码":"股票代码","股票简称":"股票简称","净利润":"净利润(亿元)","营业收入":"营业收入(亿元)","销售毛利率":"销售毛利率%","资产负债率":"资产负债率%",ROE:"ROE%","市净率":"市净率","市盈率":"市盈率","大单净量":"大单净量","大单净额":"大单净额(亿元)",MACD:"MACD",KDJ:"KDJ",BOLL:"BOLL","单k组合":"单k组合","均线":"均线","陆股通净流入":"陆股通净流入(万元)","大单净量":"大单净量","大单净额":"大单净额(万元)"}[e]||e),getColumnWidth:e=>({"股票代码":110,"股票简称":110,"净利润":140,"营业收入":145,"销售毛利率":140,"资产负债率":135,ROE:95,"市净率":95,"市盈率":90,"大单净量":105,"大单净额":140,MACD:120,KDJ:120,BOLL:120,"单k组合":120,"均线":120,"陆股通净流入":150,"大单净量":105,"大单净额":140,"题材":200,"题材描述":300,"主题":200,"股票简称":120,"热度值":100,"特色指标":120}[e]||110),getColumnFormatter:e=>({"净利润":a.formatYiYuan,"营业收入":a.formatYiYuan,"销售毛利率":a.formatPercent,"资产负债率":a.formatPercent,ROE:a.formatPercent,"市净率":a.formatNumber,"市盈率":a.formatPercent,"大单净量":a.formatNumber,"大单净额":a.formatYiYuan,"陆股通净流入":a.formatMoney}[e]||null)}}},mt={class:"filter-results-table"},ht={class:"stock-table"},pt=["href","onClick"],gt=["onMouseenter"],ft={key:2},vt=["href","onClick"],Ct=["onMouseenter"],yt={key:2},kt=q(ut,[["render",function(e,o,i,c,d,u){const m=n("el-tooltip"),p=n("el-table-column"),v=n("el-table"),C=n("el-card"),y=n("el-pagination");return l(),t("div",mt,[a(C,{class:"results-card",shadow:"never"},{default:s(()=>[r("div",ht,[(l(),k(v,{ref:"tableRef",key:c.tableRenderKey,data:c.paginatedStockList,style:{width:"100%"},fit:!1,"empty-text":"请设置筛选条件后查看结果",height:c.tableHeight,"max-height":c.tableMaxHeight,"default-sort":i.isThemeMode?{prop:i.themeColumns[0]||"code",order:"ascending"}:{prop:i.dataColumns[0]||"code",order:"ascending"},onSortChange:c.handleSortChange,stripe:"","header-cell-style":c.headerCellStyle,"cell-style":c.cellStyle},{default:s(()=>[i.isThemeMode?(l(!0),t(g,{key:0},f(c.visibleThemeColumns,e=>(l(),k(p,{key:e,prop:e,label:e,"min-width":c.getColumnWidth(e),align:"center",sortable:!!c.isSortableColumn(e)&&"custom","show-overflow-tooltip":"描述"!==e,resizable:!1},{default:s(({row:a,$index:n})=>[T([a[e],n],()=>(l(),t("div",null,["股票代码"===e?(l(),t("a",{key:0,href:c.formatStockAnalysisUrl(a[e]),class:"stock-code-link",onClick:t=>c.onCodeClick(t,a[e])},h(a[e]),9,pt)):"股票简称"===e?(l(),k(m,{content:c.getStockTooltipContent(c.getStockCode(a)),placement:"top",disabled:!1,"show-after":800,"raw-content":!0,"popper-class":"stock-tooltip","popper-style":{width:"300px",maxWidth:"300px"},key:`tooltip-${c.getStockCode(a)}-${c.stockTooltips[c.getStockCode(a)]?"loaded":"loading"}`},{default:s(()=>[r("span",{class:"stock-name-hover",onMouseenter:e=>c.handleStockNameHover(c.getStockCode(a))},h(a[e]),41,gt)]),_:2},1032,["content"])):(l(),t("span",ft,h(a[e]),1))])),o,0)]),_:2},1032,["prop","label","min-width","sortable","show-overflow-tooltip"]))),128)):(l(!0),t(g,{key:1},f(c.visibleDataColumns,e=>(l(),k(p,{key:e,prop:e,label:c.getColumnLabel(e),"min-width":c.getColumnWidth(e),align:"center",sortable:!!c.isSortableColumn(e)&&"custom","show-overflow-tooltip":"股票简称"!==e,formatter:c.getColumnFormatter(e),resizable:!1},{default:s(({row:a,$index:n})=>[T([a[e],n],()=>(l(),t("div",null,["股票代码"===e?(l(),t("a",{key:0,href:c.formatStockAnalysisUrl(a[e]),class:"stock-code-link",onClick:t=>c.onCodeClick(t,a[e])},h(a[e]),9,vt)):"股票简称"===e?(l(),k(m,{content:c.getStockTooltipContent(c.getStockCode(a)),placement:"top",disabled:!1,"show-after":800,"raw-content":!0,"popper-class":"stock-tooltip","popper-style":{width:"300px",maxWidth:"300px"},key:`tooltip-${c.getStockCode(a)}-${c.stockTooltips[c.getStockCode(a)]?"loaded":"loading"}`},{default:s(()=>[r("span",{class:"stock-name-hover",onMouseenter:e=>c.handleStockNameHover(c.getStockCode(a))},h(a[e]),41,Ct)]),_:2},1032,["content"])):(l(),t("span",yt,h(a[e]),1))])),o,1)]),_:2},1032,["prop","label","min-width","sortable","show-overflow-tooltip","formatter"]))),128))]),_:1},8,["data","height","max-height","default-sort","onSortChange","header-cell-style","cell-style"]))])]),_:1}),a(y,{"current-page":c.currentPage,"onUpdate:currentPage":o[2]||(o[2]=e=>c.currentPage=e),"page-size":c.pageSize,"onUpdate:pageSize":o[3]||(o[3]=e=>c.pageSize=e),total:i.stockList.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c.handlePageSizeChange,onCurrentChange:c.handleCurrentPageChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])}],["__scopeId","data-v-8e419245"]]),St={name:"StockDetail",props:{modelValue:{type:Boolean,default:!1},currentStock:{type:Object,default:null}},emits:["update:modelValue","close"],setup:(e,{emit:t})=>({visible:y({get:()=>e.modelValue,set:e=>t("update:modelValue",e)}),handleClose:()=>{t("close")},getPriceClass:qe,formatYiYuan:Ze})},bt={key:0,class:"stock-detail"},wt=q(St,[["render",function(e,o,i,c,d,u){const p=n("el-descriptions-item"),g=n("el-descriptions"),f=n("el-dialog");return l(),k(f,{modelValue:c.visible,"onUpdate:modelValue":o[0]||(o[0]=e=>c.visible=e),title:"股票详情",width:"60%",center:"",onClose:c.handleClose},{default:s(()=>[i.currentStock?(l(),t("div",bt,[a(g,{column:2,border:""},{default:s(()=>[a(p,{label:"股票代码"},{default:s(()=>[m(h(i.currentStock.code),1)]),_:1}),a(p,{label:"股票名称"},{default:s(()=>[m(h(i.currentStock.name),1)]),_:1}),a(p,{label:"当前价格"},{default:s(()=>[r("span",{class:v(c.getPriceClass(i.currentStock.change))}," ¥"+h(i.currentStock.price.toFixed(2)),3)]),_:1}),a(p,{label:"涨跌幅"},{default:s(()=>[r("span",{class:v(c.getPriceClass(i.currentStock.change))},h(i.currentStock.changePercent>0?"+":"")+h(i.currentStock.changePercent.toFixed(2))+"% ",3)]),_:1}),a(p,{label:"营业收入"},{default:s(()=>[m(h(c.formatYiYuan(null,null,i.currentStock.revenue)),1)]),_:1}),a(p,{label:"净利润"},{default:s(()=>[m(h(c.formatYiYuan(null,null,i.currentStock.netProfit)),1)]),_:1}),a(p,{label:"市盈率"},{default:s(()=>[m(h(i.currentStock.pe),1)]),_:1}),a(p,{label:"市净率"},{default:s(()=>[m(h(i.currentStock.pb),1)]),_:1}),a(p,{label:"ROE"},{default:s(()=>[m(h(i.currentStock.roe)+"%",1)]),_:1}),a(p,{label:"MACD"},{default:s(()=>[m(h(i.currentStock.macd),1)]),_:1}),a(p,{label:"KDJ"},{default:s(()=>[m(h(i.currentStock.kdj),1)]),_:1}),a(p,{label:"大单净量"},{default:s(()=>[m(h(i.currentStock.bigOrderNet),1)]),_:1})]),_:1})])):S("",!0)]),_:1},8,["modelValue","onClose"])}],["__scopeId","data-v-fe73fe8c"]]),_t={revenue:"营业收入",pe:"市盈率",grossMargin:"销售毛利率",roe:"ROE",netProfit:"净利润",pb:"市净率",debtRatio:"资产负债率"},Tt={macd:"MACD",kdj:"KDJ",boll:"BOLL",kPattern:"单k组合",ma:"均线"},At={bigOrderNet:"大单净量",bigOrderAmount:"大单净额",hkConnect:"陆股通净流入"},Mt={"营业收入":"revenue","市盈率":"pe","销售毛利率":"grossMargin",ROE:"roe","净利润":"netProfit","市净率":"pb","资产负债率":"debtRatio",MACD:"macd",KDJ:"kdj",BOLL:"boll","单k组合":"kPattern","均线":"ma","大单净量":"bigOrderNet","大单净额":"bigOrderAmount","陆股通净流入":"hkConnect"},Ot={fundamental:_t,technical:Tt,capital:At,chineseToEnglish:Mt};"undefined"!=typeof window&&(window.FactorMapping={FUNDAMENTAL_NAME_MAP:_t,TECHNICAL_NAME_MAP:Tt,CAPITAL_NAME_MAP:At,CHINESE_TO_ENGLISH_MAP:Mt,ALL_FACTOR_MAPPING:Ot}),void 0!==z&&z.exports&&(z.exports={FUNDAMENTAL_NAME_MAP:_t,TECHNICAL_NAME_MAP:Tt,CAPITAL_NAME_MAP:At,CHINESE_TO_ENGLISH_MAP:Mt,ALL_FACTOR_MAPPING:Ot}),void 0!==e&&(e.FUNDAMENTAL_NAME_MAP=_t,e.TECHNICAL_NAME_MAP=Tt,e.CAPITAL_NAME_MAP=At,e.CHINESE_TO_ENGLISH_MAP=Mt,e.ALL_FACTOR_MAPPING=Ot);const Pt=(e,t={})=>Array.isArray(e)?e.map(e=>{const t={"股票代码":e.code||e["股票代码"]||"",...e};return delete t.con_code,delete t.code,t}):[],Lt=e=>{if(!Array.isArray(e))return e;const t=[],a=[];return e.includes("股票代码")&&t.push("股票代码"),e.includes("股票简称")&&t.push("股票简称"),e.forEach(e=>{"股票代码"!==e&&"股票简称"!==e&&a.push(e)}),[...t,...a]};function It(){const e=c({}),t=i([]),a=i(!1),n=i([]),o=i([]),l=i(!1),r=i(!1),s=i(null),d=i(null),u=i(new Map),m=12e4,h=(e,t)=>`${e}:${JSON.stringify(t)}`,p=e=>{const t=u.value.get(e);return t&&Date.now()-t.timestamp<m?t.data:null},g=(e,t)=>{u.value.size>=30&&f(),u.value.set(e,{data:t,timestamp:Date.now()})},f=()=>{const e=Date.now(),t=u.value;for(const[a,n]of t.entries())e-n.timestamp>m&&t.delete(a);if(t.size>30){const e=Array.from(t.entries());e.sort((e,t)=>e[1].timestamp-t[1].timestamp),e.slice(0,t.size-Math.floor(24)).forEach(([e])=>t.delete(e))}},v=i(!1),C=i([]),k=i(""),S=i(1),b=i(20),w=i(0),T=i(null),A=c({prop:"code",order:"ascending"}),M=y(()=>{const e=[...t.value];if(A.prop){const{prop:t,order:a}=A,n="descending"===a?-1:1;e.sort((e,a)=>{const o=e[t],l=a[t];return"number"==typeof o&&"number"==typeof l?(o-l)*n:String(o??"").localeCompare(String(l??""))*n})}const a=(S.value-1)*b.value,n=a+b.value;return e.slice(a,n)}),O=async(r={...e},s={})=>{const i=!!s.silent;l.value=!0,S.value=1;try{const{factors:e,selectedFactors:s,themes:c,indicator:d}=(e=>{var t;const a=[],n={fundamental:[],technical:[],capital:[]};let o="";const l=(null==e?void 0:e.fundamental)||{},r=_t;Object.keys(r).forEach(e=>{const t=l[e];if(!t)return;const o=r[e],s=((e,t=!1)=>{if("string"!=typeof e)return e;const a=t?"亿":"",n=e.match(/^(\d+(?:\.\d+)?)以上$/);if(n)return`大于${n[1]}${a}`;const o=e.match(/^(\d+(?:\.\d+)?)以下$/);if(o)return`小于${o[1]}${a}`;const l=e.match(/^(\d+(?:\.\d+)?)~(\d+(?:\.\d+)?)$/);return l?t?`${l[1]}~${l[2]}${a}`:`${l[1]}~${l[2]}`:/\d/.test(e)?`${e}${a}`:e})(t,"revenue"===e||"netProfit"===e);a.push(`${o}_${s}`),n.fundamental.push(o)});const s=(null==e?void 0:e.indicator)||{};s.special&&(o=s.special);const i=(null==e?void 0:e.technical)||{};i.macd&&(a.push(`MACD_${i.macd}`),n.technical.push("MACD")),i.kdj&&(a.push(`KDJ_${i.kdj}`),n.technical.push("KDJ")),i.boll&&(a.push(`BOLL_${i.boll}`),n.technical.push("BOLL")),i.kPattern&&(a.push(`单k组合_${i.kPattern}`),n.technical.push("单k组合")),i.ma&&("多头排列"===i.ma&&(a.push("均线_多头排列"),n.technical.push("均线")),"均线粘合"===i.ma&&(a.push("均线_粘合"),n.technical.push("均线")),"股价站上5日线"===i.ma&&(a.push("股价站上5日线"),n.technical.push("均线")),"股价站上60日线"===i.ma&&(a.push("均线_股价站上60日线"),n.technical.push("均线")));const c=(null==e?void 0:e.capital)||{},d=At;Object.keys(d).forEach(e=>{const t=c[e];if(!t)return;const o=d[e];let l=t;"hkConnect"===e&&(l=/\d/.test(t)?`${t}万`:t),"bigOrderAmount"===e&&(l=String(t).replace(/万$/,"")),a.push(`${o}_${l}`),n.capital.push(o)});const u=(null==(t=null==e?void 0:e.hotConcept)?void 0:t.themes)||[];return{factors:a,selectedFactors:n,themes:u,indicator:o}})(r);if(0===e.length&&0===c.length&&!d)return t.value=[],a.value=!1,n.value=[],o.value=[],void(l.value=!1);let u,m;(c.length>0||e.length>0)&&d?(u=h("themes_factors_zhibiao",{themes:c,factors:e,indicator:d}),m=p(u),m||(m=await((e,t,a)=>J("/stock/filter/themes-factors-zhibiao",{themes:e,factors:t,zhibiao:a}))(c,e,d),g(u,m))):c.length>0&&e.length>0?(u=h("multi_theme_factor",{themes:c,factors:e}),m=p(u),m||(m=await((e,t)=>J("/stock/filter/themes-and-factors",{themes:e,factors:t}))(c,e),g(u,m))):c.length>0?(u=h("themes",{themes:c}),m=p(u),m||(m=await(e=>J("/stock/filter/themes",{themes:e}))(c),g(u,m))):e.length>0?(u=h("factors",{factors:e}),m=p(u),m||(m=await(e=>J("/stock/filter/factors",{factors:e}))(e),g(u,m))):d&&(m=await K(d));const f=(null==m?void 0:m.data)??m;let C=f;Array.isArray(f)?C=f:(null==f?void 0:f.stocks)?C=f.stocks:(null==f?void 0:f.data)?C=f.data:"object"==typeof f&&null!==f&&(C=Object.entries(f).map(([e,t])=>"object"==typeof t&&null!==t&&0===Object.keys(t).length?{"股票代码":e,"股票简称":`股票${e}`}:{"股票代码":e,...t}));const y=Array.isArray(C)?C:[];if(c.length>0||c.length>0&&e.length>0){const e=Pt(y,s);t.value=e,a.value=!0,n.value=e.length>0?Lt(Object.keys(e[0])):[],o.value=[],v.value=!0}else{const e=Pt(y,s);t.value=e,a.value=!1,n.value=[],o.value=e.length>0?Lt(Object.keys(e[0])):lt,v.value=!1}i||(y.length?P.success(`搜索完成，搜索到${y.length}支股票`):P.info("未找到符合条件的股票"))}catch(c){t.value=[],i||P.error("搜索失败，请稍后重试")}finally{l.value=!1}},L=async e=>{try{const l=await K(e),r=(null==l?void 0:l.data)??l;let s=[];Array.isArray(r)?s=r:"object"==typeof r&&null!==r&&(s=Object.entries(r).map(([e,t])=>"object"==typeof t&&null!==t&&0===Object.keys(t).length?{"股票代码":e,"股票简称":`股票${e}`}:{"股票代码":e,...t}));const i=Pt(s,{});t.value=i,a.value=!1,n.value=[],o.value=i.length>0?Lt(Object.keys(i[0])):lt,v.value=!1,k.value=e,P.success(`搜索完成，搜索到${s.length}支股票`)}catch(l){t.value=[],P.error("获取特色指标数据失败，请稍后重试")}};return _(()=>{d.value&&clearTimeout(d.value),u.value.clear()}),{currentFilters:e,stockList:t,isThemeMode:a,themeColumns:n,dataColumns:o,searchLoading:l,showStockDetail:r,currentStock:s,showTimeFilter:v,dateRange:C,lastIndicatorSelected:k,currentPage:S,pageSize:b,tableRenderKey:w,tableRef:T,currentSort:A,paginatedStockList:M,handleFilterChange:l=>{const r=((e,t={})=>{const{isThemeMode:a=!1,themeColumns:n=[],dataColumns:o=[],DEFAULT_CODE_COLUMNS:l=[]}=t;if("indicator"===(null==e?void 0:e.category)&&"special"===(null==e?void 0:e.condition)){const t=null==e?void 0:e.value,a=(null==e?void 0:e.allFilters)||{};if(!t)return{shouldSkip:!1,result:{stockList:[],isThemeMode:!1,themeColumns:[],dataColumns:[],showTimeFilter:!1,lastIndicatorSelected:""}};if(!Object.keys(a).some(e=>{var t;if("indicator"===e)return!1;if("hotConcept"===e)return Array.isArray(null==(t=null==a?void 0:a.hotConcept)?void 0:t.themes)&&a.hotConcept.themes.length>0;const n=a[e];return n&&Object.values(n).some(e=>!!e)}))return{shouldSkip:!1,result:{selected:t,isStaticData:!0}}}const r=e.allFilters||{};return 0===Object.keys(r).length?{shouldSkip:!1,result:{stockList:[],isThemeMode:!1,themeColumns:[],dataColumns:[],currentSort:{prop:"股票代码",order:"ascending"}}}:{shouldSkip:!1,result:{filters:r,shouldSearch:!0}}})(l,{isThemeMode:a.value,themeColumns:n.value,dataColumns:o.value,DEFAULT_CODE_COLUMNS:lt});if(!r.shouldSkip){if(Object.assign(e,l.allFilters||{}),r.result){const{stockList:e,isThemeMode:s,themeColumns:i,dataColumns:c,showTimeFilter:d,lastIndicatorSelected:u,selected:m,isStaticData:h,currentSort:p}=r.result;if(void 0!==e&&(t.value=e),void 0!==s&&(a.value=s),void 0!==i&&(n.value=i),void 0!==c&&(o.value=c),void 0!==d&&(v.value=d),void 0!==u&&(k.value=u),void 0!==p&&(p.prop=p.prop,p.order=p.order),h&&m)return void L(m);if(void 0!==e&&0===e.length&&0===Object.keys(l.allFilters||{}).length)return}d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{O({...e},{silent:!1})},400)}},handleSearch:O,handleViewDetail:e=>{s.value=e,r.value=!0},handleStockCodeClick:e=>{},handlePageSizeChange:e=>{b.value=e,S.value=1},handleCurrentPageChange:e=>{S.value=e},handleSortChange:({prop:e,order:t})=>{A.prop=e,A.order=t,S.value=1},handleDateRangeChange:e=>{C.value=e,k.value&&L(k.value)}}}const Rt={class:"stock-filter-page"},xt={class:"page-content"},Dt=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:ee,meta:{requiresAuth:!1,title:"登录 - 选股助手"}},{path:"/stock-filter",name:"StockFilter",component:q({name:"StockFilter",components:{FilterPanel:Ve,AppHeader:Ye,StockTable:kt,StockDetail:wt},setup:()=>({...It(),handleLogout:()=>{}})},[["render",function(e,o,i,c,d,u){const m=n("AppHeader"),h=n("FilterPanel"),p=n("el-col"),g=n("el-row"),f=n("StockTable"),v=n("StockDetail");return l(),t("div",Rt,[a(m,{onLogout:c.handleLogout},null,8,["onLogout"]),r("div",xt,[a(g,{gutter:20},{default:s(()=>[a(p,{span:24},{default:s(()=>[a(h,{onFilterChange:e.handleFilterChange},null,8,["onFilterChange"])]),_:1})]),_:1}),a(f,{"stock-list":e.stockList,"is-theme-mode":e.isThemeMode,"theme-columns":e.themeColumns,"data-columns":e.dataColumns,"show-time-filter":e.showTimeFilter,"date-range":e.dateRange,"onUpdate:dateRange":o[0]||(o[0]=t=>e.dateRange=t),onDateRangeChange:e.handleDateRangeChange,onSortChange:e.handleSortChange,onViewDetail:e.handleViewDetail},null,8,["stock-list","is-theme-mode","theme-columns","data-columns","show-time-filter","date-range","onDateRangeChange","onSortChange","onViewDetail"])]),a(v,{modelValue:e.showStockDetail,"onUpdate:modelValue":o[1]||(o[1]=t=>e.showStockDetail=t),"current-stock":e.currentStock,onClose:o[2]||(o[2]=t=>e.showStockDetail=!1)},null,8,["modelValue","current-stock"])])}],["__scopeId","data-v-2d5eb184"]]),meta:{requiresAuth:!0,title:"股票筛选 - 选股助手"}}],Et=A({history:M(),routes:Dt});Et.beforeEach((e,t,a)=>{e.meta.title&&(document.title=e.meta.title);const n=e.matched.some(e=>e.meta.requiresAuth),o="true"===localStorage.getItem("isLoggedIn");n&&!o?a("/login"):"/login"===e.path&&o?a("/stock-filter"):a()});const Ft=O(X);Ft.use(E),Ft.use(Et);for(const[t,a]of Object.entries(F))Ft.component(t,a);Ft.mount("#app")}},function(){return U||(0,z[e(z)[0]])((U={exports:{}}).exports,U),U.exports});export default $();
